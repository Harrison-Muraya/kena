{% extends 'coin/base.html' %}
{% load static %}

{% block content %}
    {% include "partials/header.html" %}
    

    {% block header %} {% endblock %}
    <!-- Hero Section -->
    <div class="container mx-auto px-6 py-16">
        <div class="text-center mb-16">
            <h1 class="text-6xl md:text-7xl font-bold mb-6">
                <span class="bg-gradient-to-r from-kena-gold via-yellow-400 to-kena-gold bg-clip-text text-transparent">
                    The Future of
                </span>
                <br>
                <span class="text-white">Digital Currency</span>
            </h1>
            <p class="text-xl text-gray-300 max-w-2xl mx-auto mb-8">
                Experience lightning-fast transactions, secure mining, and seamless integration with traditional payment methods.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button class="px-8 py-4 bg-gradient-to-r from-kena-gold to-yellow-500 text-black rounded-lg hover:from-yellow-500 hover:to-kena-gold transition-all font-semibold text-lg">
                    Start Mining Now
                </button>
                <button class="px-8 py-4 border border-white/30 text-white rounded-lg hover:bg-white/10 transition-all text-lg">
                    View Explorer
                </button>
            </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-16">
            <div class="bg-white/5 backdrop-blur-md rounded-xl p-6 border border-white/10 text-center">
                <div class="text-3xl font-bold text-kena-gold" id="totalSupply">1,250,000</div>
                <div class="text-gray-300 text-sm">Total Supply</div>
            </div>
            <div class="bg-white/5 backdrop-blur-md rounded-xl p-6 border border-white/10 text-center">
                <div class="text-3xl font-bold text-green-400" id="blockHeight">15,847</div>
                <div class="text-gray-300 text-sm">Block Height</div>
            </div>
            <div class="bg-white/5 backdrop-blur-md rounded-xl p-6 border border-white/10 text-center">
                <div class="text-3xl font-bold text-blue-400" id="pendingTx">23</div>
                <div class="text-gray-300 text-sm">Pending TX</div>
            </div>
            <div class="bg-white/5 backdrop-blur-md rounded-xl p-6 border border-white/10 text-center">
                <div class="text-3xl font-bold text-purple-400" id="hashRate">2.4 TH/s</div>
                <div class="text-gray-300 text-sm">Hash Rate</div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid lg:grid-cols-2 gap-8 mb-16">
            <!-- Recent Blocks -->
            <div class="bg-white/5 backdrop-blur-md rounded-2xl p-6 border border-white/10">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold flex items-center">
                        <span class="w-3 h-3 bg-green-400 rounded-full mr-3 animate-pulse"></span>
                        Latest Blocks
                    </h2>
                    <button class="text-kena-gold hover:text-yellow-400 text-sm">View All</button>
                </div>
                <div class="space-y-4" id="blocksList">
                    <div class="flex justify-between items-center p-4 bg-white/5 rounded-lg border border-white/5">
                        <div>
                            <div class="font-semibold text-kena-gold">#15847</div>
                            <div class="text-sm text-gray-400">2 minutes ago</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm">142 transactions</div>
                            <div class="text-xs text-gray-400">Mined by: 0x7a9f...</div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center p-4 bg-white/5 rounded-lg border border-white/5">
                        <div>
                            <div class="font-semibold text-kena-gold">#15846</div>
                            <div class="text-sm text-gray-400">5 minutes ago</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm">89 transactions</div>
                            <div class="text-xs text-gray-400">Mined by: 0x3b2c...</div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center p-4 bg-white/5 rounded-lg border border-white/5">
                        <div>
                            <div class="font-semibold text-kena-gold">#15845</div>
                            <div class="text-sm text-gray-400">8 minutes ago</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm">203 transactions</div>
                            <div class="text-xs text-gray-400">Mined by: 0x9d8e...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Unverified Transactions -->
            <div class="bg-white/5 backdrop-blur-md rounded-2xl p-6 border border-white/10">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold flex items-center">
                        <span class="w-3 h-3 bg-yellow-400 rounded-full mr-3 animate-pulse"></span>
                        Pending Transactions
                    </h2>
                    <button class="text-kena-gold hover:text-yellow-400 text-sm">View All</button>
                </div>
                <div class="space-y-4" id="pendingTxList">
                    <p class="text-gray-400 text-center">Loading...</p>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="mb-16">
            <h2 class="text-4xl font-bold text-center mb-12">Why Choose Kena?</h2>
            <div class="grid md:grid-cols-3 gap-8">
                <div class="bg-white/5 backdrop-blur-md rounded-2xl p-8 border border-white/10 text-center hover:bg-white/10 transition-all">
                    <div class="w-16 h-16 bg-gradient-to-br from-kena-gold to-yellow-500 rounded-full flex items-center justify-center mx-auto mb-6">
                        <svg class="w-8 h-8 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold mb-4">Lightning Fast</h3>
                    <p class="text-gray-300">Experience near-instant transactions with our optimized blockchain technology.</p>
                </div>
                <div class="bg-white/5 backdrop-blur-md rounded-2xl p-8 border border-white/10 text-center hover:bg-white/10 transition-all">
                    <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold mb-4">Secure & Private</h3>
                    <p class="text-gray-300">Advanced cryptographic security ensures your transactions remain private and secure.</p>
                </div>
                <div class="bg-white/5 backdrop-blur-md rounded-2xl p-8 border border-white/10 text-center hover:bg-white/10 transition-all">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold mb-4">Easy Integration</h3>
                    <p class="text-gray-300">Seamlessly integrate with M-Pesa, PayPal, and credit cards for easy on/off ramps.</p>
                </div>
            </div>
        </div>

        <!-- Call to Action -->
        <div class="bg-gradient-to-r from-kena-gold/20 to-yellow-500/20 backdrop-blur-md rounded-2xl p-12 border border-kena-gold/30 text-center">
            <h2 class="text-4xl font-bold mb-6">Ready to Join the Kena Revolution?</h2>
            <p class="text-xl text-gray-300 mb-8 max-w-2xl mx-auto">
                Start your journey with Kena today. Mine, trade, and transact with the next generation of cryptocurrency.
            </p>
            <button class="px-8 py-4 bg-gradient-to-r from-kena-gold to-yellow-500 text-black rounded-lg hover:from-yellow-500 hover:to-kena-gold transition-all font-semibold text-lg mr-4">
                Create Wallet
            </button>
            <button class="px-8 py-4 border border-kena-gold text-kena-gold rounded-lg hover:bg-kena-gold hover:text-black transition-all text-lg">
                Learn More
            </button>
        </div>
    </div>
    {% include "partials/footer.html" %}
    {% block footer %} {% endblock %}

    <script>
    // Determine WebSocket protocol based on page protocol
    const wsProtocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
    const wsUrl = wsProtocol + window.location.host + '/ws/transactions/';
    
    console.log('Attempting to connect to:', wsUrl);
    
    let socket;
    let reconnectAttempts = 0;
    const maxReconnectAttempts = 2;
    const reconnectDelay = 3000; // 3 seconds

    function connectWebSocket() {
        socket = new WebSocket(wsUrl);

        socket.onopen = function(e) {
            console.log('WebSocket connected successfully');
            reconnectAttempts = 0;
            updateConnectionStatus('connected');
        };

        socket.onmessage = function(e) {
            console.log('Received message:', e.data);
            try {
                const data = JSON.parse(e.data);
                const container = document.querySelector('#pendingTxList');
                
                if (!container) {
                    console.error('Container #pendingTxList not found');
                    return;
                }

                if (!data.transactions || data.transactions.length === 0) {
                    container.innerHTML = '<p class="text-gray-400 text-center">No pending transactions</p>';
                    return;
                }

                container.innerHTML = '';
                data.transactions.forEach(txn => {
                    const txElement = document.createElement('div');
                    txElement.className = 'p-4 bg-white/5 rounded-lg border border-white/5 hover:bg-white/10 transition-all';
                    txElement.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div class="text-sm text-gray-400 font-mono">${txn.hash.slice(0, 8)}...${txn.hash.slice(-6)}</div>
                            <div class="text-kena-gold font-semibold">+${parseFloat(txn.amount).toFixed(2)} KENA</div>
                        </div>
                        <div class="text-xs text-gray-500">${txn.timestamp}</div>
                    `;
                    container.appendChild(txElement);
                });
            } catch (error) {
                console.error('Error parsing WebSocket message:', error);
            }
        };

        socket.onerror = function(error) {
            console.error('WebSocket error:', error);
            updateConnectionStatus('error');
        };

        socket.onclose = function(e) {
            console.log('WebSocket closed:', e.code, e.reason);
            updateConnectionStatus('disconnected');
            
            // Attempt to reconnect
            if (reconnectAttempts < maxReconnectAttempts) {
                reconnectAttempts++;
                console.log(`Reconnecting... Attempt ${reconnectAttempts}/${maxReconnectAttempts}`);
                setTimeout(connectWebSocket, reconnectDelay);
            } else {
                console.error('Max reconnection attempts reached');
                const container = document.querySelector('#pendingTxList');
                if (container) {
                    container.innerHTML = `
                        <div class="text-center py-4">
                            <p class="text-red-400 mb-2">Connection lost</p>
                            <button onclick="location.reload()" class="px-4 py-2 bg-kena-gold text-black rounded-lg hover:bg-yellow-500 transition-all">
                                Reload Page
                            </button>
                        </div>
                    `;
                }
            }
        };
    }

    function updateConnectionStatus(status) {
        const statusIndicator = document.querySelector('.animate-pulse');
        if (statusIndicator) {
            switch(status) {
                case 'connected':
                    statusIndicator.className = 'w-3 h-3 bg-green-400 rounded-full mr-3 animate-pulse';
                    break;
                case 'disconnected':
                    statusIndicator.className = 'w-3 h-3 bg-gray-400 rounded-full mr-3';
                    break;
                case 'error':
                    statusIndicator.className = 'w-3 h-3 bg-red-400 rounded-full mr-3 animate-pulse';
                    break;
            }
        }
    }

    // Initialize connection when page loads
    connectWebSocket();

    // Clean up on page unload
    window.addEventListener('beforeunload', function() {
        if (socket && socket.readyState === WebSocket.OPEN) {
            socket.close();
        }
    });
</script>



{% endblock %}
